!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dat=t():e.dat=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var l=n[o]={exports:{},id:o,loaded:!1};return e[o].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var l=n(1),r=o(l);e.exports=r.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function r(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];t?n.innerHTML=n.value+"*":n.innerHTML=n.value}function a(e,t,n){if(n.__li=t,n.__gui=e,X.default.extend(n,{options:function(t){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),i(e,n.object,n.property,{before:o,factoryArgs:[X.default.toArray(arguments)]})}if(X.default.isArray(t)||X.default.isObject(t)){var l=n.__li.nextElementSibling;return n.remove(),i(e,n.object,n.property,{before:l,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof H.default)!function(){var e=new U.default(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});X.default.each(["updateDisplay","onChange","onFinishChange","step"],function(t){var o=n[t],l=e[t];n[t]=e[t]=function(){var t=Array.prototype.slice.call(arguments);return l.apply(e,t),o.apply(n,t)}}),F.default.addClass(t,"has-slider"),n.domElement.insertBefore(e.domElement,n.domElement.firstElementChild)}();else if(n instanceof U.default){var o=function(t){if(X.default.isNumber(n.__min)&&X.default.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,l=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=i(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(o),l&&r.listen(),r}return t};n.min=X.default.compose(o,n.min),n.max=X.default.compose(o,n.max)}else n instanceof D.default?(F.default.bind(t,"click",function(){F.default.fakeEvent(n.__checkbox,"click")}),F.default.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof N.default?(F.default.bind(t,"click",function(){F.default.fakeEvent(n.__button,"click")}),F.default.bind(t,"mouseover",function(){F.default.addClass(n.__button,"hover")}),F.default.bind(t,"mouseout",function(){F.default.removeClass(n.__button,"hover")})):n instanceof I.default&&(F.default.addClass(t,"color"),n.updateDisplay=X.default.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=X.default.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&r(e.getRoot(),!0),t},n.setValue)}function d(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(o!==-1){var l=n.__rememberedObjectIndecesToControllers[o];if(void 0===l&&(l={},n.__rememberedObjectIndecesToControllers[o]=l),l[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[K])return;a=r[K]}if(a[o]&&void 0!==a[o][t.property]){var d=a[o][t.property];t.initialValue=d,t.setValue(d)}}}}function i(e,t,n,o){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;if(o.color)r=new I.default(t,n);else{var i=[t,n].concat(o.factoryArgs);r=y.default.apply(e,i)}o.before instanceof S.default&&(o.before=o.before.__li),d(e,r),F.default.addClass(r.domElement,"c");var s=document.createElement("span");F.default.addClass(s,"property-name"),s.innerHTML=r.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(r.domElement);var c=l(e,u,o.before);return F.default.addClass(c,oe.CLASS_CONTROLLER_ROW),r instanceof I.default?F.default.addClass(c,"color"):F.default.addClass(c,b(r.getValue())),a(e,c,r),e.__controllers.push(r),r}function s(e,t){return document.location.href+"."+t}function u(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function c(e,t){t.style.display=e.useLocalStorage?"block":"none"}function f(e){var t=e.__save_row=document.createElement("li");F.default.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),F.default.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",F.default.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",F.default.addClass(o,"button"),F.default.addClass(o,"save");var l=document.createElement("span");l.innerHTML="New",F.default.addClass(l,"button"),F.default.addClass(l,"save-as");var r=document.createElement("span");r.innerHTML="Revert",F.default.addClass(r,"button"),F.default.addClass(r,"revert");var a=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?X.default.each(e.load.remembered,function(t,n){u(e,n,n===e.preset)}):u(e,K,!1),F.default.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(l),t.appendChild(r),Q&&!function(){var t=document.getElementById("dg-local-explain"),n=document.getElementById("dg-local-storage"),o=document.getElementById("dg-save-locally");o.style.display="block","true"===localStorage.getItem(s(e,"isLocal"))&&n.setAttribute("checked","checked"),c(e,t),F.default.bind(n,"change",function(){e.useLocalStorage=!e.useLocalStorage,c(e,t)})}();var d=document.getElementById("dg-new-constructor");F.default.bind(d,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Z.hide()}),F.default.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Z.show(),d.focus(),d.select()}),F.default.bind(o,"click",function(){e.save()}),F.default.bind(l,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),F.default.bind(r,"click",function(){e.revert()})}function _(e){function t(t){return t.preventDefault(),e.width+=l-t.clientX,e.onResize(),l=t.clientX,!1}function n(){F.default.removeClass(e.__closeButton,oe.CLASS_DRAG),F.default.unbind(window,"mousemove",t),F.default.unbind(window,"mouseup",n)}function o(o){return o.preventDefault(),l=o.clientX,F.default.addClass(e.__closeButton,oe.CLASS_DRAG),F.default.bind(window,"mousemove",t),F.default.bind(window,"mouseup",n),!1}var l=void 0;e.__resize_handle=document.createElement("div"),X.default.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),F.default.bind(e.__resize_handle,"mousedown",o),F.default.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function m(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function h(e,t){var n={};return X.default.each(e.__rememberedObjects,function(o,l){var r={},a=e.__rememberedObjectIndecesToControllers[l];X.default.each(a,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[l]=r}),n}function p(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function v(e){0!==e.length&&j.default.call(window,function(){v(e)}),X.default.each(e,function(e){e.updateDisplay()})}var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C=n(!function(){var e=new Error('Cannot find module "../utils/css"');throw e.code="MODULE_NOT_FOUND",e}()),E=o(C),g=n(!function(){var e=new Error('Cannot find module "./saveDialogue.html"');throw e.code="MODULE_NOT_FOUND",e}()),w=o(g),O=n(!function(){var e=new Error('Cannot find module "../controllers/ControllerFactory"');throw e.code="MODULE_NOT_FOUND",e}()),y=o(O),L=n(!function(){var e=new Error('Cannot find module "../controllers/Controller"');throw e.code="MODULE_NOT_FOUND",e}()),S=o(L),T=n(!function(){var e=new Error('Cannot find module "../controllers/BooleanController"');throw e.code="MODULE_NOT_FOUND",e}()),D=o(T),A=n(!function(){var e=new Error('Cannot find module "../controllers/FunctionController"');throw e.code="MODULE_NOT_FOUND",e}()),N=o(A),x=n(!function(){var e=new Error('Cannot find module "../controllers/NumberControllerBox"');throw e.code="MODULE_NOT_FOUND",e}()),U=o(x),M=n(!function(){var e=new Error('Cannot find module "../controllers/NumberControllerSlider"');throw e.code="MODULE_NOT_FOUND",e}()),H=o(M),R=n(!function(){var e=new Error('Cannot find module "../controllers/ColorController"');throw e.code="MODULE_NOT_FOUND",e}()),I=o(R),k=n(!function(){var e=new Error('Cannot find module "../utils/requestAnimationFrame"');throw e.code="MODULE_NOT_FOUND",e}()),j=o(k),z=n(!function(){var e=new Error('Cannot find module "../dom/CenteredDiv"');throw e.code="MODULE_NOT_FOUND",e}()),B=o(z),P=n(!function(){var e=new Error('Cannot find module "../dom/dom"');throw e.code="MODULE_NOT_FOUND",e}()),F=o(P),V=n(!function(){var e=new Error('Cannot find module "../utils/common"');throw e.code="MODULE_NOT_FOUND",e}()),X=o(V),G=n(!function(){var e=new Error('Cannot find module "./style.scss"');throw e.code="MODULE_NOT_FOUND",e}()),W=o(G);E.default.inject(W.default);var J="dg",Y=72,q=20,K="Default",Q=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),Z=void 0,$=!0,ee=void 0,te=!1,ne=[],oe=function e(t){function n(){var e=o.getRoot();e.width+=1,X.default.defer(function(){e.width-=1})}var o=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),F.default.addClass(this.domElement,J),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=X.default.defaults(r,{autoPlace:!0,width:e.DEFAULT_WIDTH}),r=X.default.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),X.default.isUndefined(r.load)?r.load={preset:K}:r.preset&&(r.load.preset=r.preset),X.default.isUndefined(r.parent)&&r.hideable&&ne.push(this),r.resizable=X.default.isUndefined(r.parent)&&r.resizable,r.autoPlace&&X.default.isUndefined(r.scrollable)&&(r.scrollable=!0);var a=Q&&"true"===localStorage.getItem(s(this,"isLocal")),d=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},preset:{get:function(){return o.parent?o.getRoot().preset:r.load.preset},set:function(e){o.parent?o.getRoot().preset=e:r.load.preset=e,p(this),o.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,m(o,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,titleRowName&&(titleRowName.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?F.default.addClass(o.__ul,e.CLASS_CLOSED):F.default.removeClass(o.__ul,e.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(e){Q&&(a=e,e?F.default.bind(window,"unload",d):F.default.unbind(window,"unload",d),localStorage.setItem(s(o,"isLocal"),e))}}}),X.default.isUndefined(r.parent)){if(r.closed=!1,F.default.addClass(this.domElement,e.CLASS_MAIN),F.default.makeSelectable(this.domElement,!1),Q&&a){o.useLocalStorage=!0;var i=localStorage.getItem(s(this,"gui"));i&&(r.load=JSON.parse(i))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,F.default.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),F.default.bind(this.__closeButton,"click",function(){o.closed=!o.closed})}else{void 0===r.closed&&(r.closed=!0);var u=document.createTextNode(r.name);F.default.addClass(u,"controller-name");var c=l(o,u),f=function(e){return e.preventDefault(),o.closed=!o.closed,!1};F.default.addClass(this.__ul,e.CLASS_CLOSED),F.default.addClass(c,"title"),F.default.bind(c,"click",f),r.closed||(this.closed=!1)}r.autoPlace&&(X.default.isUndefined(r.parent)&&($&&(ee=document.createElement("div"),F.default.addClass(ee,J),F.default.addClass(ee,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ee),$=!1),ee.appendChild(this.domElement),F.default.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||m(o,r.width)),this.__resizeHandler=function(){o.onResize()},F.default.bind(window,"resize",this.__resizeHandler),F.default.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),F.default.bind(this.__ul,"transitionend",this.__resizeHandler),F.default.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&_(this),d=function(){Q&&"true"===localStorage.getItem(s(o,"isLocal"))&&localStorage.setItem(s(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=d,r.parent||n()};oe.toggleHide=function(){te=!te,X.default.each(ne,function(e){e.domElement.style.display=te?"none":""})},oe.CLASS_AUTO_PLACE="a",oe.CLASS_AUTO_PLACE_CONTAINER="ac",oe.CLASS_MAIN="main",oe.CLASS_CONTROLLER_ROW="cr",oe.CLASS_TOO_TALL="taller-than-window",oe.CLASS_CLOSED="closed",oe.CLASS_CLOSE_BUTTON="close-button",oe.CLASS_DRAG="drag",oe.DEFAULT_WIDTH=245,oe.TEXT_CLOSED="Close Controls",oe.TEXT_OPEN="Open Controls",oe._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==Y&&e.keyCode!==Y||oe.toggleHide()},F.default.bind(window,"keydown",oe._keydownHandler,!1),X.default.extend(oe.prototype,{add:function(e,t){return i(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return i(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;X.default.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&ee.removeChild(this.domElement),F.default.unbind(window,"keydown",oe._keydownHandler,!1),F.default.unbind(window,"resize",this.__resizeHandler),this.saveToLocalStorageIfPossible&&F.default.unbind(window,"unload",this.saveToLocalStorageIfPossible)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new oe(t);this.__folders[e]=n;var o=l(this,n.domElement);return F.default.addClass(o,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name];var t=this;X.default.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:X.default.debounce(function(){var e=this.getRoot();if(e.scrollable){var t=F.default.getOffset(e.__ul).top,n=0;X.default.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=F.default.getHeight(t))}),window.innerHeight-t-q<n?(F.default.addClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-q+"px"):(F.default.removeClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&X.default.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},200),remember:function(){if(X.default.isUndefined(Z)&&(Z=new B.default,Z.domElement.innerHTML=w.default),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;X.default.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&f(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&m(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=h(this)),e.folders={},X.default.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=h(this),r(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[K]=h(this,!0)),this.load.remembered[e]=h(this),this.preset=e,u(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){X.default.each(this.__controllers,function(t){this.getRoot().load.remembered?d(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),X.default.each(this.__folders,function(e){e.revert(e)}),e||r(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&v(this.__listening)},updateDisplay:function(){X.default.each(this.__controllers,function(e){e.updateDisplay()}),X.default.each(this.__folders,function(e){e.updateDisplay()})}}),e.exports=oe}])});