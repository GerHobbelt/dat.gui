!(function(e, t) {
  "object" == typeof exports && "undefined" != typeof module
    ? t(exports)
    : "function" == typeof define && define.amd
    ? define(["exports"], t)
    : t(((e = e || self).dat = {}));
})(this, function(e) {
  "use strict";
  function t(e, t) {
    var n = e.__state.conversionName.toString(),
      i = Math.round(e.r),
      o = Math.round(e.g),
      r = Math.round(e.b),
      s = e.a,
      a = Math.round(e.h),
      l = e.s.toFixed(1),
      d = e.v.toFixed(1);
    if (t || "THREE_CHAR_HEX" === n || "SIX_CHAR_HEX" === n) {
      for (var c = e.hex.toString(16); c.length < 6; ) c = "0" + c;
      return "#" + c;
    }
    return "CSS_RGB" === n
      ? "rgb(" + i + "," + o + "," + r + ")"
      : "CSS_RGBA" === n
      ? "rgba(" + i + "," + o + "," + r + "," + s + ")"
      : "HEX" === n
      ? "0x" + e.hex.toString(16)
      : "RGB_ARRAY" === n
      ? "[" + i + "," + o + "," + r + "]"
      : "RGBA_ARRAY" === n
      ? "[" + i + "," + o + "," + r + "," + s + "]"
      : "RGB_OBJ" === n
      ? "{r:" + i + ",g:" + o + ",b:" + r + "}"
      : "RGBA_OBJ" === n
      ? "{r:" + i + ",g:" + o + ",b:" + r + ",a:" + s + "}"
      : "HSV_OBJ" === n
      ? "{h:" + a + ",s:" + l + ",v:" + d + "}"
      : "HSVA_OBJ" === n
      ? "{h:" + a + ",s:" + l + ",v:" + d + ",a:" + s + "}"
      : "unknown format";
  }
  var n,
    s = Array.prototype.forEach,
    i = Array.prototype.slice,
    _ = {
      BREAK: {},
      extend: function(n) {
        return (
          this.each(
            i.call(arguments, 1),
            function(t) {
              (this.isObject(t) ? Object.keys(t) : []).forEach(
                function(e) {
                  this.isUndefined(t[e]) || (n[e] = t[e]);
                }.bind(this)
              );
            },
            this
          ),
          n
        );
      },
      defaults: function(n) {
        return (
          this.each(
            i.call(arguments, 1),
            function(t) {
              (this.isObject(t) ? Object.keys(t) : []).forEach(
                function(e) {
                  this.isUndefined(n[e]) && (n[e] = t[e]);
                }.bind(this)
              );
            },
            this
          ),
          n
        );
      },
      compose: function() {
        var n = i.call(arguments);
        return function() {
          for (var e = i.call(arguments), t = n.length - 1; 0 <= t; t--) e = [n[t].apply(this, e)];
          return e[0];
        };
      },
      each: function(e, t, n) {
        if (e)
          if (s && e.forEach && e.forEach === s) e.forEach(t, n);
          else if (e.length === e.length + 0) {
            var i, o;
            for (i = 0, o = e.length; i < o; i++) if (i in e && t.call(n, e[i], i) === this.BREAK) return;
          } else for (var r in e) if (t.call(n, e[r], r) === this.BREAK) return;
      },
      defer: function(e) {
        setTimeout(e, 0);
      },
      debounce: function(i, o, r) {
        var s;
        return function() {
          var e = this,
            t = arguments;
          var n = r || !s;
          clearTimeout(s),
            (s = setTimeout(function() {
              (s = null), r || i.apply(e, t);
            }, o)),
            n && i.apply(e, t);
        };
      },
      toArray: function(e) {
        return e.toArray ? e.toArray() : i.call(e);
      },
      isUndefined: function(e) {
        return void 0 === e;
      },
      isNull: function(e) {
        return null === e;
      },
      isNaN: ((n = function(e) {
        return isNaN(e);
      }),
      (o.toString = function() {
        return n.toString();
      }),
      o),
      isArray:
        Array.isArray ||
        function(e) {
          return e.constructor === Array;
        },
      isObject: function(e) {
        return e === Object(e);
      },
      isNumber: function(e) {
        return e === e + 0;
      },
      isString: function(e) {
        return e === e + "";
      },
      isBoolean: function(e) {
        return !1 === e || !0 === e;
      },
      isFunction: function(e) {
        return "[object Function]" === Object.prototype.toString.call(e);
      }
    };
  function o(e) {
    return n.apply(this, arguments);
  }
  function h(e) {
    a = !1;
    var n = 1 < arguments.length ? _.toArray(arguments) : e;
    return (
      _.each(c, function(e) {
        if (e.litmus(n))
          return (
            _.each(e.conversions, function(e, t) {
              if (((r = e.read(n)), !1 === a && !1 !== r))
                return ((a = r).conversionName = t), (r.conversion = e), _.BREAK;
            }),
            _.BREAK
          );
      }),
      a
    );
  }
  var r,
    a,
    l,
    d,
    c = [
      {
        litmus: _.isString,
        conversions: {
          THREE_CHAR_HEX: {
            read: function(e) {
              var t = e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);
              return (
                null !== t && {
                  space: "HEX",
                  hex: parseInt(
                    "0x" +
                      t[1].toString() +
                      t[1].toString() +
                      t[2].toString() +
                      t[2].toString() +
                      t[3].toString() +
                      t[3].toString(),
                    0
                  )
                }
              );
            },
            write: t
          },
          SIX_CHAR_HEX: {
            read: function(e) {
              var t = e.match(/^#([A-F0-9]{6})$/i);
              return null !== t && { space: "HEX", hex: parseInt("0x" + t[1].toString(), 0) };
            },
            write: t
          },
          CSS_RGB: {
            read: function(e) {
              var t = e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
              return null !== t && { space: "RGB", r: parseFloat(t[1]), g: parseFloat(t[2]), b: parseFloat(t[3]) };
            },
            write: t
          },
          CSS_RGBA: {
            read: function(e) {
              var t = e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
              return (
                null !== t && {
                  space: "RGB",
                  r: parseFloat(t[1]),
                  g: parseFloat(t[2]),
                  b: parseFloat(t[3]),
                  a: parseFloat(t[4])
                }
              );
            },
            write: t
          }
        }
      },
      {
        litmus: _.isNumber,
        conversions: {
          HEX: {
            read: function(e) {
              return { space: "HEX", hex: e, conversionName: "HEX" };
            },
            write: function(e) {
              return e.hex;
            }
          }
        }
      },
      {
        litmus: _.isArray,
        conversions: {
          RGB_ARRAY: {
            read: function(e) {
              return 3 === e.length && { space: "RGB", r: e[0], g: e[1], b: e[2] };
            },
            write: function(e) {
              return [e.r, e.g, e.b];
            }
          },
          RGBA_ARRAY: {
            read: function(e) {
              return 4 === e.length && { space: "RGB", r: e[0], g: e[1], b: e[2], a: e[3] };
            },
            write: function(e) {
              return [e.r, e.g, e.b, e.a];
            }
          }
        }
      },
      {
        litmus: _.isObject,
        conversions: {
          RGBA_OBJ: {
            read: function(e) {
              return (
                !!(_.isNumber(e.r) && _.isNumber(e.g) && _.isNumber(e.b) && _.isNumber(e.a)) && {
                  space: "RGB",
                  r: e.r,
                  g: e.g,
                  b: e.b,
                  a: e.a
                }
              );
            },
            write: function(e) {
              return { r: e.r, g: e.g, b: e.b, a: e.a };
            }
          },
          RGB_OBJ: {
            read: function(e) {
              return (
                !!(_.isNumber(e.r) && _.isNumber(e.g) && _.isNumber(e.b)) && { space: "RGB", r: e.r, g: e.g, b: e.b }
              );
            },
            write: function(e) {
              return { r: e.r, g: e.g, b: e.b };
            }
          },
          HSVA_OBJ: {
            read: function(e) {
              return (
                !!(_.isNumber(e.h) && _.isNumber(e.s) && _.isNumber(e.v) && _.isNumber(e.a)) && {
                  space: "HSV",
                  h: e.h,
                  s: e.s,
                  v: e.v,
                  a: e.a
                }
              );
            },
            write: function(e) {
              return { h: e.h, s: e.s, v: e.v, a: e.a };
            }
          },
          HSV_OBJ: {
            read: function(e) {
              return (
                !!(_.isNumber(e.h) && _.isNumber(e.s) && _.isNumber(e.v)) && { space: "HSV", h: e.h, s: e.s, v: e.v }
              );
            },
            write: function(e) {
              return { h: e.h, s: e.s, v: e.v };
            }
          }
        }
      }
    ],
    u = {
      hsv_to_rgb: function(e, t, n) {
        var i = Math.floor(e / 60) % 6,
          o = e / 60 - Math.floor(e / 60),
          r = n * (1 - t),
          s = n * (1 - o * t),
          a = n * (1 - (1 - o) * t),
          l = [[n, a, r], [s, n, r], [r, n, a], [r, s, n], [a, r, n], [n, r, s]][i];
        return { r: 255 * l[0], g: 255 * l[1], b: 255 * l[2] };
      },
      rgb_to_hsv: function(e, t, n) {
        var i,
          o = Math.min(e, t, n),
          r = Math.max(e, t, n),
          s = r - o;
        return 0 === r
          ? { h: NaN, s: 0, v: 0 }
          : ((i = e === r ? (t - n) / s : t === r ? 2 + (n - e) / s : 4 + (e - t) / s),
            (i /= 6) < 0 && (i += 1),
            { h: 360 * i, s: s / r, v: r / 255 });
      },
      rgb_to_hex: function(e, t, n) {
        var i = this.hex_with_component(0, 2, e);
        return (i = this.hex_with_component(i, 1, t)), (i = this.hex_with_component(i, 0, n));
      },
      component_from_hex: function(e, t) {
        return (e >> (8 * t)) & 255;
      },
      hex_with_component: function(e, t, n) {
        return (n = (n << (l = 8 * t)) | (e & ~(255 << l)));
      }
    },
    f = (((d = p.prototype).toString = function() {
      return t(this);
    }),
    (d.toHexString = function() {
      return t(this, !0);
    }),
    (d.toOriginal = function() {
      return this.__state.conversion.write(this);
    }),
    p);
  function p() {
    if (((this.__state = h.apply(this, arguments)), !1 === this.__state))
      throw new Error("Failed to interpret color arguments");
    this.__state.a = this.__state.a || 1;
  }
  function m(e, t, n) {
    Object.defineProperty(e, t, {
      get: function() {
        return "RGB" === this.__state.space || f.recalculateRGB(this, t, n), this.__state[t];
      },
      set: function(e) {
        "RGB" !== this.__state.space && (f.recalculateRGB(this, t, n), (this.__state.space = "RGB")),
          (this.__state[t] = e);
      }
    });
  }
  function b(e, t) {
    Object.defineProperty(e, t, {
      get: function() {
        return "HSV" === this.__state.space || f.recalculateHSV(this), this.__state[t];
      },
      set: function(e) {
        "HSV" !== this.__state.space && (f.recalculateHSV(this), (this.__state.space = "HSV")), (this.__state[t] = e);
      }
    });
  }
  (f.recalculateRGB = function(e, t, n) {
    if ("HEX" === e.__state.space) e.__state[t] = u.component_from_hex(e.__state.hex, n);
    else {
      if ("HSV" !== e.__state.space) throw new Error("Corrupted color state");
      _.extend(e.__state, u.hsv_to_rgb(e.__state.h, e.__state.s, e.__state.v));
    }
  }),
    (f.recalculateHSV = function(e) {
      var t = u.rgb_to_hsv(e.r, e.g, e.b);
      _.extend(e.__state, { s: t.s, v: t.v }),
        _.isNaN(t.h) ? _.isUndefined(e.__state.h) && (e.__state.h = 0) : (e.__state.h = t.h);
    }),
    (f.COMPONENTS = ["r", "g", "b", "h", "s", "v", "hex", "a"]),
    m(f.prototype, "r", 2),
    m(f.prototype, "g", 1),
    m(f.prototype, "b", 0),
    b(f.prototype, "h"),
    b(f.prototype, "s"),
    b(f.prototype, "v"),
    Object.defineProperty(f.prototype, "a", {
      get: function() {
        return this.__state.a;
      },
      set: function(e) {
        this.__state.a = e;
      }
    }),
    Object.defineProperty(f.prototype, "hex", {
      get: function() {
        return (
          "HEX" !== !this.__state.space && (this.__state.hex = u.rgb_to_hex(this.r, this.g, this.b)), this.__state.hex
        );
      },
      set: function(e) {
        (this.__state.space = "HEX"), (this.__state.hex = e);
      }
    });
  var g,
    v = (((g = y.prototype).onChange = function(e) {
      return (this.__onChange = e), this;
    }),
    (g.onFinishChange = function(e) {
      return (this.__onFinishChange = e), this;
    }),
    (g.setValue = function(e) {
      return (
        (this.object[this.property] = e), this.__onChange && this.__onChange.call(this, e), this.updateDisplay(), this
      );
    }),
    (g.getValue = function() {
      return this.object[this.property];
    }),
    (g.updateDisplay = function() {
      return this;
    }),
    (g.isModified = function() {
      return this.initialValue !== this.getValue();
    }),
    (g.borderColor = function(e) {
      return (this.__li.style.borderLeftColor = e), this;
    }),
    (g.borderWidth = function(e) {
      return (this.__li.style.borderLeftWidth = e + "px"), this;
    }),
    y);
  function y(e, t) {
    (this.initialValue = e[t]),
      (this.domElement = document.createElement("div")),
      (this.object = e),
      (this.property = t),
      (this.__onChange = void 0),
      (this.__onFinishChange = void 0);
  }
  function w(e, t) {
    (e.prototype = Object.create(t.prototype)), ((e.prototype.constructor = e).__proto__ = t);
  }
  function E(e) {
    if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    return e;
  }
  var C = {};
  _.each(
    {
      HTMLEvents: ["change"],
      MouseEvents: ["click", "mousemove", "mousedown", "mouseup", "mouseover"],
      KeyboardEvents: ["keydown"]
    },
    function(e, t) {
      _.each(e, function(e) {
        C[e] = t;
      });
    }
  );
  var x = /(\d+(\.\d+)?)px/;
  function S(e) {
    if ("0" === e || _.isUndefined(e)) return 0;
    var t = e.match(x);
    return _.isNull(t) ? 0 : parseFloat(t[1]);
  }
  var k,
    A = {
      makeSelectable: function(e, t) {
        void 0 !== e &&
          void 0 !== e.style &&
          ((e.onselectstart = t
            ? function() {
                return !1;
              }
            : function() {}),
          (e.style.MozUserSelect = t ? "auto" : "none"),
          (e.style.KhtmlUserSelect = t ? "auto" : "none"),
          (e.unselectable = t ? "on" : "off"));
      },
      makeFullscreen: function(e, t, n) {
        var i = n,
          o = t;
        _.isUndefined(o) && (o = !0),
          _.isUndefined(i) && (i = !0),
          (e.style.position = "absolute"),
          o && ((e.style.left = 0), (e.style.right = 0)),
          i && ((e.style.top = 0), (e.style.bottom = 0));
      },
      fakeEvent: function(e, t, n, i) {
        var o = n || {},
          r = C[t];
        if (!r) throw new Error("Event type " + t + " not supported.");
        var s = document.createEvent(r);
        switch (r) {
          case "MouseEvents":
            var a = o.x || o.clientX || 0,
              l = o.y || o.clientY || 0;
            s.initMouseEvent(
              t,
              o.bubbles || !1,
              o.cancelable || !0,
              window,
              o.clickCount || 1,
              0,
              0,
              a,
              l,
              !1,
              !1,
              !1,
              !1,
              0,
              null
            );
            break;
          case "KeyboardEvents":
            var d = s.initKeyboardEvent || s.initKeyEvent;
            _.defaults(o, {
              cancelable: !0,
              ctrlKey: !1,
              altKey: !1,
              shiftKey: !1,
              metaKey: !1,
              keyCode: void 0,
              charCode: void 0
            }),
              d(
                t,
                o.bubbles || !1,
                o.cancelable,
                window,
                o.ctrlKey,
                o.altKey,
                o.shiftKey,
                o.metaKey,
                o.keyCode,
                o.charCode
              );
            break;
          default:
            s.initEvent(t, o.bubbles || !1, o.cancelable || !0);
        }
        _.defaults(s, i), e.dispatchEvent(s);
      },
      bind: function(e, t, n, i) {
        var o = i || !1;
        return e.addEventListener ? e.addEventListener(t, n, o) : e.attachEvent && e.attachEvent("on" + t, n), A;
      },
      unbind: function(e, t, n, i) {
        var o = i || !1;
        return e.removeEventListener ? e.removeEventListener(t, n, o) : e.detachEvent && e.detachEvent("on" + t, n), A;
      },
      addClass: function(e, t) {
        if (void 0 === e.className) e.className = t;
        else if (e.className !== t) {
          var n = e.className.split(/ +/);
          -1 === n.indexOf(t) &&
            (n.push(t),
            (e.className = n
              .join(" ")
              .replace(/^\s+/, "")
              .replace(/\s+$/, "")));
        }
        return A;
      },
      removeClass: function(e, t) {
        if (t)
          if (e.className === t) e.removeAttribute("class");
          else {
            var n = e.className.split(/ +/),
              i = n.indexOf(t);
            -1 !== i && (n.splice(i, 1), (e.className = n.join(" ")));
          }
        else e.className = void 0;
        return A;
      },
      hasClass: function(e, t) {
        return new RegExp("(?:^|\\s+)" + t + "(?:\\s+|$)").test(e.className) || !1;
      },
      getWidth: function(e) {
        var t = getComputedStyle(e);
        return (
          S(t["border-left-width"]) +
          S(t["border-right-width"]) +
          S(t["padding-left"]) +
          S(t["padding-right"]) +
          S(t.width)
        );
      },
      getHeight: function(e) {
        var t = getComputedStyle(e);
        return (
          S(t["border-top-width"]) +
          S(t["border-bottom-width"]) +
          S(t["padding-top"]) +
          S(t["padding-bottom"]) +
          S(t.height)
        );
      },
      getOffset: function(e) {
        var t = e,
          n = { left: 0, top: 0 };
        if (t.offsetParent) for (; (n.left += t.offsetLeft), (n.top += t.offsetTop), (t = t.offsetParent); );
        return n;
      },
      isActive: function(e) {
        return e === document.activeElement && (e.type || e.href);
      }
    },
    O = (function(o) {
      function e(e, t) {
        var n,
          i = E((n = o.call(this, e, t) || this));
        return (
          (n.__prev = n.getValue()),
          (n.__checkbox = document.createElement("input")),
          n.__checkbox.setAttribute("type", "checkbox"),
          A.bind(
            n.__checkbox,
            "change",
            function() {
              i.setValue(!i.__prev);
            },
            !1
          ),
          n.domElement.appendChild(n.__checkbox),
          n.updateDisplay(),
          n
        );
      }
      w(e, o);
      var t = e.prototype;
      return (
        (t.setValue = function(e) {
          var t = o.prototype.setValue.call(this, e);
          return (
            this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()),
            (this.__prev = this.getValue()),
            t
          );
        }),
        (t.updateDisplay = function() {
          return (
            !0 === this.getValue()
              ? (this.__checkbox.setAttribute("checked", "checked"), (this.__checkbox.checked = !0), (this.__prev = !0))
              : ((this.__checkbox.checked = !1), (this.__prev = !1)),
            o.prototype.updateDisplay.call(this)
          );
        }),
        e
      );
    })(v),
    T = (function(a) {
      function e(e, t, n) {
        var i,
          o = n,
          r = E((i = a.call(this, e, t) || this));
        if (((i.__select = document.createElement("select")), _.isArray(o))) {
          var s = {};
          _.each(o, function(e) {
            s[e] = e;
          }),
            (o = s);
        }
        return (
          _.each(o, function(e, t) {
            var n = document.createElement("option");
            (n.innerHTML = t), n.setAttribute("value", e), r.__select.appendChild(n);
          }),
          i.updateDisplay(),
          A.bind(i.__select, "change", function() {
            var e = this.options[this.selectedIndex].value;
            r.setValue(e);
          }),
          i.domElement.appendChild(i.__select),
          i
        );
      }
      w(e, a);
      var t = e.prototype;
      return (
        (t.setValue = function(e) {
          var t = a.prototype.setValue.call(this, e);
          return this.__onFinishChange && this.__onFinishChange.call(this, this.getValue()), t;
        }),
        (t.updateDisplay = function() {
          return A.isActive(this.__select)
            ? this
            : ((this.__select.value = this.getValue()), a.prototype.updateDisplay.call(this));
        }),
        e
      );
    })(v),
    L = (w(R, (k = v)),
    (R.prototype.updateDisplay = function() {
      return A.isActive(this.__input) || (this.__input.value = this.getValue()), k.prototype.updateDisplay.call(this);
    }),
    R);
  function R(e, t) {
    var n,
      i = E((n = k.call(this, e, t) || this));
    function o() {
      i.setValue(i.__input.value);
    }
    return (
      (n.__input = document.createElement("input")),
      n.__input.setAttribute("type", "text"),
      A.bind(n.__input, "keyup", o),
      A.bind(n.__input, "change", o),
      A.bind(n.__input, "blur", function() {
        i.__onFinishChange && i.__onFinishChange.call(i, i.getValue());
      }),
      A.bind(n.__input, "keydown", function(e) {
        13 === e.keyCode && this.blur();
      }),
      n.updateDisplay(),
      n.domElement.appendChild(n.__input),
      n
    );
  }
  function N(e) {
    var t = e.toString();
    return -1 < t.indexOf(".") ? t.length - t.indexOf(".") - 1 : 0;
  }
  var H = (function(r) {
    function e(e, t, n) {
      var i,
        o = n || {};
      return (
        ((i = r.call(this, e, t) || this).__min = o.min),
        (i.__max = o.max),
        (i.__step = o.step),
        _.isUndefined(i.__step)
          ? 0 === i.initialValue
            ? (i.__impliedStep = 1)
            : (i.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(i.initialValue)) / Math.LN10)) / 10)
          : (i.__impliedStep = i.__step),
        (i.__precision = N(i.__impliedStep)),
        i
      );
    }
    w(e, r);
    var t = e.prototype;
    return (
      (t.setValue = function(e) {
        var t = e;
        return (
          void 0 !== this.__min && t < this.__min
            ? (t = this.__min)
            : void 0 !== this.__max && t > this.__max && (t = this.__max),
          void 0 !== this.__step && t % this.__step != 0 && (t = Math.round(t / this.__step) * this.__step),
          r.prototype.setValue.call(this, t)
        );
      }),
      (t.min = function(e) {
        return (this.__min = e), this;
      }),
      (t.max = function(e) {
        return (this.__max = e), this;
      }),
      (t.step = function(e) {
        return (this.__step = e), (this.__impliedStep = e), (this.__precision = N(e)), this;
      }),
      e
    );
  })(v);
  var B,
    V = (w(D, (B = H)),
    (D.prototype.updateDisplay = function() {
      var e = params && params.suffix ? params.suffix : "";
      return (
        (this.__input.value = this.__truncationSuspended
          ? this.getValue()
          : (function(e, t) {
              var n = Math.pow(10, t);
              return Math.round(e * n) / n;
            })(this.getValue(), this.__precision) + e),
        B.prototype.updateDisplay.call(this)
      );
    }),
    D);
  function D(e, t, n) {
    var i;
    (i = B.call(this, e, t, n) || this).__truncationSuspended = !1;
    var o,
      r = E(i);
    function s() {
      r.__onFinishChange && r.__onFinishChange.call(r, r.getValue());
    }
    function a(e) {
      var t = o - e.clientY;
      r.setValue(r.getValue() + t * r.__impliedStep), (o = e.clientY);
    }
    function l() {
      A.unbind(window, "mousemove", a), A.unbind(window, "mouseup", l), s();
    }
    return (
      (i.__input = document.createElement("input")),
      i.__input.setAttribute("type", "text"),
      A.bind(i.__input, "change", function() {
        var e = r.__input.value;
        n && n.suffix && (e = e.replace(n.suffix, ""));
        var t = parseFloat(e);
        _.isNaN(t) || r.setValue(t);
      }),
      A.bind(i.__input, "blur", function() {
        s();
      }),
      A.bind(i.__input, "mousedown", function(e) {
        A.bind(window, "mousemove", a), A.bind(window, "mouseup", l), (o = e.clientY);
      }),
      A.bind(i.__input, "keydown", function(e) {
        13 === e.keyCode && ((r.__truncationSuspended = !0), this.blur(), (r.__truncationSuspended = !1), s());
      }),
      i.updateDisplay(),
      i.domElement.appendChild(i.__input),
      i
    );
  }
  var F,
    I = (w(M, (F = H)),
    (M.prototype.updateDisplay = function() {
      var e = (this.getValue() - this.__min) / (this.__max - this.__min);
      return (this.__foreground.style.width = 100 * e + "%"), F.prototype.updateDisplay.call(this);
    }),
    M);
  function M(e, t, n, i, o) {
    var r,
      s = E((r = F.call(this, e, t, { min: n, max: i, step: o }) || this));
    function a(e) {
      d(e.clientX);
    }
    function l(e) {
      for (var t = e.changedTouches, n = 0; n < t.length; n++)
        t[n].identifier === s.__activeTouch.identifier && d(t[n].clientX);
    }
    function d(e) {
      var t = s.__background.getBoundingClientRect();
      return (
        s.setValue(
          (function(e, t, n, i, o) {
            return i + ((e - t) / (n - t)) * (o - i);
          })(e, t.left, t.right, s.__min, s.__max)
        ),
        !1
      );
    }
    function c() {
      A.unbind(window, "touchmove", a), A.unbind(window, "touchend", u), (s.__activeTouch = null), _();
    }
    function u() {
      A.unbind(window, "mousemove", a), A.unbind(window, "mouseup", u), _();
    }
    function _() {
      s.__onFinishChange && s.__onFinishChange.call(s, s.getValue());
    }
    return (
      (r.__background = document.createElement("div")),
      (r.__foreground = document.createElement("div")),
      A.bind(r.__background, "mousedown", function(e) {
        document.activeElement.blur(), A.bind(window, "mousemove", a), A.bind(window, "mouseup", u), a(e);
      }),
      A.bind(r.__background, "touchstart", function(e) {
        document.activeElement.blur(),
          A.bind(window, "touchmove", l),
          A.bind(window, "touchend", c),
          (s.__activeTouch = e.targetTouches[0]),
          l(e);
      }),
      A.addClass(r.__background, "slider"),
      A.addClass(r.__foreground, "slider-fg"),
      r.updateDisplay(),
      r.__background.appendChild(r.__foreground),
      r.domElement.appendChild(r.__background),
      r
    );
  }
  var j,
    z = (w(P, (j = v)),
    (P.prototype.fire = function() {
      this.__onChange && this.__onChange.call(this),
        this.getValue().call(this.object),
        this.__onFinishChange && this.__onFinishChange.call(this, this.getValue());
    }),
    P);
  function P(e, t, n) {
    var i,
      o = E((i = j.call(this, e, t) || this));
    return (
      (i.__button = document.createElement("div")),
      (i.__button.innerHTML = void 0 === n ? "Fire" : n),
      A.bind(i.__button, "click", function(e) {
        return e.preventDefault(), o.fire(), !1;
      }),
      A.addClass(i.__button, "button"),
      i.domElement.appendChild(i.__button),
      i
    );
  }
  var G,
    U = (w(X, (G = v)),
    (X.prototype.updateDisplay = function() {
      var t = h(this.getValue());
      if (!1 !== t) {
        var n = !1;
        _.each(
          f.COMPONENTS,
          function(e) {
            if (!_.isUndefined(t[e]) && !_.isUndefined(this.__color.__state[e]) && t[e] !== this.__color.__state[e])
              return (n = !0), {};
          },
          this
        ),
          n && _.extend(this.__color.__state, t);
      }
      _.extend(this.__temp.__state, this.__color.__state), (this.__temp.a = 1);
      var e = this.__color.v < 0.5 || 0.5 < this.__color.s ? 255 : 0,
        i = 255 - e;
      _.extend(this.__field_knob.style, {
        marginLeft: 100 * this.__color.s - 7 + "px",
        marginTop: 100 * (1 - this.__color.v) - 7 + "px",
        backgroundColor: this.__temp.toHexString(),
        border: this.__field_knob_border + "rgb(" + e + "," + e + "," + e + ")"
      }),
        (this.__hue_knob.style.marginTop = 100 * (1 - this.__color.h / 360) + "px"),
        (this.__temp.s = 1),
        (this.__temp.v = 1),
        J(this.__saturation_field, "left", "#fff", this.__temp.toHexString()),
        (this.__input.value = this.__color.toString()),
        _.extend(this.__input.style, {
          backgroundColor: this.__color.toHexString(),
          color: "rgb(" + e + "," + e + "," + e + ")",
          textShadow: this.__input_textShadow + "rgba(" + i + "," + i + "," + i + ",.7)"
        });
    }),
    X);
  function X(e, t) {
    var n;
    ((n = G.call(this, e, t) || this).__color = new f(n.getValue())), (n.__temp = new f(0));
    var o = E(n);
    (n.domElement = document.createElement("div")),
      A.makeSelectable(n.domElement, !1),
      (n.__selector = document.createElement("div")),
      (n.__selector.className = "selector"),
      (n.__saturation_field = document.createElement("div")),
      (n.__saturation_field.className = "saturation-field"),
      (n.__field_knob = document.createElement("div")),
      (n.__field_knob.className = "field-knob"),
      (n.__field_knob_border = "2px solid "),
      (n.__hue_knob = document.createElement("div")),
      (n.__hue_knob.className = "hue-knob"),
      (n.__hue_field = document.createElement("div")),
      (n.__hue_field.className = "hue-field"),
      (n.__input = document.createElement("input")),
      (n.__input.type = "text"),
      (n.__input_textShadow = "0 1px 1px "),
      A.bind(n.__input, "keydown", function(e) {
        13 === e.keyCode && a.call(this);
      }),
      A.bind(n.__input, "blur", a),
      A.bind(n.__selector, "mousedown", function() {
        A.addClass(this, "drag").bind(window, "mouseup", function() {
          A.removeClass(o.__selector, "drag");
        });
      });
    var i = document.createElement("div");
    function r(e) {
      c(e), A.bind(window, "mousemove", c), A.bind(window, "mouseup", s);
    }
    function s() {
      A.unbind(window, "mousemove", c), A.unbind(window, "mouseup", s), d();
    }
    function a() {
      var e = h(this.value);
      !1 !== e ? ((o.__color.__state = e), o.setValue(o.__color.toOriginal())) : (this.value = o.__color.toString());
    }
    function l() {
      A.unbind(window, "mousemove", u), A.unbind(window, "mouseup", l), d();
    }
    function d() {
      o.__onFinishChange && o.__onFinishChange.call(o, o.__color.toOriginal());
    }
    function c(e) {
      e.preventDefault();
      var t = o.__saturation_field.getBoundingClientRect(),
        n = (e.clientX - t.left) / (t.right - t.left),
        i = 1 - (e.clientY - t.top) / (t.bottom - t.top);
      return (
        1 < i ? (i = 1) : i < 0 && (i = 0),
        1 < n ? (n = 1) : n < 0 && (n = 0),
        (o.__color.v = i),
        (o.__color.s = n),
        o.setValue(o.__color.toOriginal()),
        !1
      );
    }
    function u(e) {
      e.preventDefault();
      var t = o.__hue_field.getBoundingClientRect(),
        n = 1 - (e.clientY - t.top) / (t.bottom - t.top);
      return 1 < n ? (n = 1) : n < 0 && (n = 0), (o.__color.h = 360 * n), o.setValue(o.__color.toOriginal()), !1;
    }
    return (
      _.extend(n.__selector.style, {
        width: "122px",
        height: "102px",
        padding: "3px",
        backgroundColor: "#222",
        boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
      }),
      _.extend(n.__field_knob.style, {
        position: "absolute",
        width: "12px",
        height: "12px",
        border: n.__field_knob_border + (n.__color.v < 0.5 ? "#fff" : "#000"),
        boxShadow: "0px 1px 3px rgba(0,0,0,0.5)",
        borderRadius: "12px",
        zIndex: 1
      }),
      _.extend(n.__hue_knob.style, {
        position: "absolute",
        width: "15px",
        height: "2px",
        borderRight: "4px solid #fff",
        zIndex: 1
      }),
      _.extend(n.__saturation_field.style, {
        width: "100px",
        height: "100px",
        border: "1px solid #555",
        marginRight: "3px",
        display: "inline-block",
        cursor: "pointer"
      }),
      _.extend(i.style, { width: "100%", height: "100%", background: "none" }),
      J(i, "top", "rgba(0,0,0,0)", "#000"),
      _.extend(n.__hue_field.style, {
        width: "15px",
        height: "100px",
        border: "1px solid #555",
        cursor: "ns-resize",
        position: "absolute",
        top: "3px",
        right: "3px"
      }),
      (function(e) {
        (e.style.background = ""),
          (e.style.cssText +=
            "background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);"),
          (e.style.cssText +=
            "background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"),
          (e.style.cssText +=
            "background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"),
          (e.style.cssText +=
            "background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"),
          (e.style.cssText +=
            "background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);");
      })(n.__hue_field),
      _.extend(n.__input.style, {
        outline: "none",
        textAlign: "center",
        color: "#fff",
        border: 0,
        fontWeight: "bold",
        textShadow: n.__input_textShadow + "rgba(0,0,0,0.7)"
      }),
      A.bind(n.__saturation_field, "mousedown", r),
      A.bind(n.__field_knob, "mousedown", r),
      A.bind(n.__hue_field, "mousedown", function(e) {
        u(e), A.bind(window, "mousemove", u), A.bind(window, "mouseup", l);
      }),
      n.__saturation_field.appendChild(i),
      n.__selector.appendChild(n.__field_knob),
      n.__selector.appendChild(n.__saturation_field),
      n.__selector.appendChild(n.__hue_field),
      n.__hue_field.appendChild(n.__hue_knob),
      n.domElement.appendChild(n.__input),
      n.domElement.appendChild(n.__selector),
      n.updateDisplay(),
      n
    );
  }
  var K = ["-moz-", "-o-", "-webkit-", "-ms-", ""];
  function J(t, n, i, o) {
    (t.style.background = ""),
      _.each(K, function(e) {
        t.style.cssText += "background: " + e + "linear-gradient(" + n + ", " + i + " 0%, " + o + " 100%); ";
      });
  }
  var W,
    Y = function(e, t) {
      var n = t || document,
        i = document.createElement("style");
      (i.type = "text/css"), (i.innerHTML = e);
      var o = n.getElementsByTagName("head")[0];
      try {
        o.appendChild(i);
      } catch (e) {}
    },
    q = function(e, t, n, i, o) {
      var r = e[t];
      return _.isArray(n) || _.isObject(n)
        ? new T(e, t, n)
        : _.isNumber(r)
        ? _.isNumber(n) && _.isNumber(i)
          ? _.isNumber(o)
            ? new I(e, t, n, i, o)
            : new I(e, t, n, i)
          : _.isNumber(o)
          ? new V(e, t, { min: n, max: i, step: o })
          : new V(e, t, { min: n, max: i })
        : _.isString(r)
        ? new L(e, t)
        : _.isFunction(r)
        ? new z(e, t, "")
        : _.isBoolean(r)
        ? new O(e, t)
        : null;
    },
    $ = (w(Q, (W = v)),
    (Q.prototype.updateDisplay = function() {
      var e = this.getValue(),
        t = [];
      for (var n in e) t.push({ percent: n, color: e[n] });
      t.sort(function(e, t) {
        return e.percent - t.percent;
      }),
        (this.__input.value = JSON.stringify(e));
      for (var i = "-webkit-linear-gradient(left", o = 0; o < t.length; o++)
        i += ", " + t[o].color + " " + 100 * t[o].percent + "%";
      (i += ")"),
        _.extend(this.__input.style, { background: i, color: "#fff", textShadow: this.__input_textShadow + " #fff" });
    }),
    Q);
  function Q(e, t, n) {
    var i,
      o = E((i = W.call(this, e, t) || this));
    function r() {
      var e = JSON.parse(this.value);
      o.setValue(e);
    }
    (i.domElement = document.createElement("div")),
      A.makeSelectable(i.domElement, !1),
      (i.__selector = document.createElement("div")),
      (i.__selector.className = "selector"),
      (i.__saturation_field = document.createElement("div")),
      (i.__saturation_field.className = "saturation-field"),
      (i.__input = document.createElement("input")),
      (i.__input.type = "text"),
      (i.__input_textShadow = "0 1px 1px "),
      A.bind(i.__input, "keydown", function(e) {
        13 === e.keyCode && r.call(this);
      }),
      A.bind(i.__input, "blur", r),
      A.bind(i.__selector, "mousedown", function() {
        A.addClass(this, "drag").bind(window, "mouseup", function() {
          A.removeClass(o.__selector, "drag");
        });
      });
    document.createElement("div");
    _.extend(i.__selector.style, {
      width: "150px",
      padding: "0px",
      lineHeight: "18px",
      backgroundColor: "#222",
      boxShadow: "0px 1px 3px rgba(0,0,0,0.3)"
    });
    for (var s = 0; s < n.length; s++) {
      var a = document.createElement("canvas");
      (a.value = n[s]), (a.width = 150), (a.height = 18);
      var l = a.getContext("2d"),
        d = l.createLinearGradient(0, 0, 150, 0);
      for (var c in n[s]) d.addColorStop(c, n[s][c]);
      A.bind(a, "click", function() {
        o.setValue(this.value), o.updateDisplay(), u();
      }),
        (l.fillStyle = d),
        l.fillRect(0, 0, a.width, a.height),
        _.extend(a.style, { width: "150px" }),
        i.__saturation_field.appendChild(a);
    }
    function u() {
      o.__onFinishChange && o.__onFinishChange.call(o, o.getValue());
    }
    return (
      i.__selector.appendChild(i.__saturation_field),
      i.domElement.appendChild(i.__input),
      i.domElement.appendChild(i.__selector),
      i.updateDisplay(),
      i
    );
  }
  var Z,
    ee =
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.oRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      function(e) {
        setTimeout(e, 1e3 / 60);
      },
    te = (((Z = ne.prototype).show = function() {
      var e = this;
      (this.backgroundElement.style.display = "block"),
        (this.domElement.style.display = "block"),
        (this.domElement.style.opacity = 0),
        (this.domElement.style.webkitTransform = "scale(1.1)"),
        this.layout(),
        _.defer(function() {
          (e.backgroundElement.style.opacity = 1),
            (e.domElement.style.opacity = 1),
            (e.domElement.style.webkitTransform = "scale(1)");
        });
    }),
    (Z.hide = function() {
      function e() {
        (t.domElement.style.display = "none"),
          (t.backgroundElement.style.display = "none"),
          A.unbind(t.domElement, "webkitTransitionEnd", e),
          A.unbind(t.domElement, "transitionend", e),
          A.unbind(t.domElement, "oTransitionEnd", e);
      }
      var t = this;
      A.bind(this.domElement, "webkitTransitionEnd", e),
        A.bind(this.domElement, "transitionend", e),
        A.bind(this.domElement, "oTransitionEnd", e),
        (this.backgroundElement.style.opacity = 0),
        (this.domElement.style.opacity = 0),
        (this.domElement.style.webkitTransform = "scale(1.1)");
    }),
    (Z.layout = function() {
      (this.domElement.style.left = window.innerWidth / 2 - A.getWidth(this.domElement) / 2 + "px"),
        (this.domElement.style.top = window.innerHeight / 2 - A.getHeight(this.domElement) / 2 + "px");
    }),
    ne);
  function ne() {
    (this.backgroundElement = document.createElement("div")),
      _.extend(this.backgroundElement.style, {
        backgroundColor: "rgba(0,0,0,0.8)",
        top: 0,
        left: 0,
        display: "none",
        zIndex: "1000",
        opacity: 0,
        WebkitTransition: "opacity 0.2s linear",
        transition: "opacity 0.2s linear"
      }),
      A.makeFullscreen(this.backgroundElement),
      (this.backgroundElement.style.position = "fixed"),
      (this.domElement = document.createElement("div")),
      _.extend(this.domElement.style, {
        position: "fixed",
        display: "none",
        zIndex: "1001",
        opacity: 0,
        WebkitTransition: "-webkit-transform 0.2s ease-out, opacity 0.2s linear",
        transition: "transform 0.2s ease-out, opacity 0.2s linear"
      }),
      document.body.appendChild(this.backgroundElement),
      document.body.appendChild(this.domElement);
    var e = this;
    A.bind(this.backgroundElement, "click", function() {
      e.hide();
    });
  }
  Y("");
  var ie,
    oe,
    re = "Default",
    se = (function() {
      try {
        return "localStorage" in window && null != window.localStorage;
      } catch (e) {
        return !1;
      }
    })(),
    ae = !0,
    le = !1,
    de = [],
    ce = function t(e) {
      var n = this,
        i = e || {};
      (this.domElement = document.createElement("div")),
        (this.__ul = document.createElement("ul")),
        this.domElement.appendChild(this.__ul),
        A.addClass(this.domElement, "dg"),
        (this.__folders = {}),
        (this.__controllers = []),
        (this.__rememberedObjects = []),
        (this.__rememberedObjectIndecesToControllers = []),
        (this.__listening = []),
        (i = _.defaults(i, { closeOnTop: !1, autoPlace: !0, width: t.DEFAULT_WIDTH })),
        (i = _.defaults(i, { resizable: i.autoPlace, hideable: i.autoPlace })),
        _.isUndefined(i.load) ? (i.load = { preset: re }) : i.preset && (i.load.preset = i.preset),
        _.isUndefined(i.parent) && i.hideable && de.push(this),
        (i.resizable = _.isUndefined(i.parent) && i.resizable),
        i.autoPlace && _.isUndefined(i.scrollable) && (i.scrollable = !0);
      var o,
        r,
        s = se && "true" === localStorage.getItem(pe(this, "isLocal"));
      if (
        (Object.defineProperties(this, {
          parent: {
            get: function() {
              return i.parent;
            }
          },
          scrollable: {
            get: function() {
              return i.scrollable;
            }
          },
          autoPlace: {
            get: function() {
              return i.autoPlace;
            }
          },
          closeOnTop: {
            get: function() {
              return i.closeOnTop;
            }
          },
          preset: {
            get: function() {
              return n.parent ? n.getRoot().preset : i.load.preset;
            },
            set: function(e) {
              n.parent ? (n.getRoot().preset = e) : (i.load.preset = e),
                (function(e) {
                  for (var t = 0; t < e.__preset_select.length; t++)
                    e.__preset_select[t].value === e.preset && (e.__preset_select.selectedIndex = t);
                })(this),
                n.revert();
            }
          },
          width: {
            get: function() {
              return i.width;
            },
            set: function(e) {
              (i.width = e), ge(n, e);
            }
          },
          name: {
            get: function() {
              return i.name;
            },
            set: function(e) {
              (i.name = e), titleRow && (titleRow.innerHTML = i.name);
            }
          },
          title: {
            get: function() {
              return i.title;
            },
            set: function(e) {
              (i.title = e),
                titleRow &&
                  (_.isString(i.title) ? titleRow.setAttribute("title", i.title) : titleRow.removeAttribute("title"));
            }
          },
          closed: {
            get: function() {
              return i.closed;
            },
            set: function(e) {
              (i.closed = e),
                i.closed ? A.addClass(n.__ul, t.CLASS_CLOSED) : A.removeClass(n.__ul, t.CLASS_CLOSED),
                this.onResize(),
                n.__closeButton && (n.__closeButton.innerHTML = e ? t.TEXT_OPEN : t.TEXT_CLOSED);
            }
          },
          load: {
            get: function() {
              return i.load;
            }
          },
          useLocalStorage: {
            get: function() {
              return s;
            },
            set: function(e) {
              se &&
                ((s = e) ? A.bind(window, "unload", o) : A.unbind(window, "unload", o),
                localStorage.setItem(pe(n, "isLocal"), e));
            }
          }
        }),
        _.isUndefined(i.parent))
      ) {
        if (
          ((i.closed = !1), A.addClass(this.domElement, t.CLASS_MAIN), A.makeSelectable(this.domElement, !1), se && s)
        ) {
          n.useLocalStorage = !0;
          var a = localStorage.getItem(pe(this, "gui"));
          a && (i.load = JSON.parse(a));
        }
        (this.__closeButton = document.createElement("div")),
          (this.__closeButton.innerHTML = t.TEXT_CLOSED),
          A.addClass(this.__closeButton, t.CLASS_CLOSE_BUTTON),
          i.closeOnTop
            ? (A.addClass(this.__closeButton, t.CLASS_CLOSE_TOP),
              this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]))
            : (A.addClass(this.__closeButton, t.CLASS_CLOSE_BOTTOM), this.domElement.appendChild(this.__closeButton)),
          A.bind(this.__closeButton, "click", function() {
            n.closed = !n.closed;
          });
      } else {
        void 0 === i.closed && (i.closed = !0);
        var l = document.createTextNode(i.name);
        A.addClass(l, "controller-name");
        var d = ue(n, l);
        _.isString(i.title) && d.setAttribute("title", i.title);
        A.addClass(this.__ul, t.CLASS_CLOSED),
          A.addClass(d, "title"),
          A.bind(d, "click", function(e) {
            return e.preventDefault(), (n.closed = !n.closed), !1;
          }),
          i.closed || (this.closed = !1);
      }
      i.autoPlace &&
        (_.isUndefined(i.parent) &&
          (ae &&
            ((oe = document.createElement("div")),
            A.addClass(oe, "dg"),
            A.addClass(oe, t.CLASS_AUTO_PLACE_CONTAINER),
            document.body.appendChild(oe),
            (ae = !1)),
          oe.appendChild(this.domElement),
          A.addClass(this.domElement, t.CLASS_AUTO_PLACE)),
        this.parent || ge(n, i.width)),
        (this.__resizeHandler = function() {
          n.onResizeDebounced();
        }),
        A.bind(window, "resize", this.__resizeHandler),
        A.bind(this.__ul, "webkitTransitionEnd", this.__resizeHandler),
        A.bind(this.__ul, "transitionend", this.__resizeHandler),
        A.bind(this.__ul, "oTransitionEnd", this.__resizeHandler),
        this.onResize(),
        i.resizable &&
          (function(t) {
            var n;
            function i(e) {
              return e.preventDefault(), (t.width += n - e.clientX), t.onResize(), (n = e.clientX), !1;
            }
            function o() {
              A.removeClass(t.__closeButton, ce.CLASS_DRAG),
                A.unbind(window, "mousemove", i),
                A.unbind(window, "mouseup", o);
            }
            function e(e) {
              return (
                e.preventDefault(),
                (n = e.clientX),
                A.addClass(t.__closeButton, ce.CLASS_DRAG),
                A.bind(window, "mousemove", i),
                A.bind(window, "mouseup", o),
                !1
              );
            }
            (t.__resize_handle = document.createElement("div")),
              _.extend(t.__resize_handle.style, {
                width: "6px",
                marginLeft: "-3px",
                height: "200px",
                cursor: "ew-resize",
                position: "absolute"
              }),
              A.bind(t.__resize_handle, "mousedown", e),
              A.bind(t.__closeButton, "mousedown", e),
              t.domElement.insertBefore(t.__resize_handle, t.domElement.firstElementChild);
          })(this),
        (o = function() {
          se &&
            "true" === localStorage.getItem(pe(n, "isLocal")) &&
            localStorage.setItem(pe(n, "gui"), JSON.stringify(n.getSaveObject()));
        }),
        (this.saveToLocalStorageIfPossible = o),
        i.parent ||
          (((r = n.getRoot()).width += 1),
          _.defer(function() {
            r.width -= 1;
          }));
    };
  function ue(e, t, n) {
    var i = document.createElement("li");
    return t && i.appendChild(t), n ? e.__ul.insertBefore(i, n) : e.__ul.appendChild(i), e.onResize(), i;
  }
  function _e(e, t) {
    var n = e.__preset_select[e.__preset_select.selectedIndex];
    n.innerHTML = t ? n.value + "*" : n.value;
  }
  function he(e, t) {
    var n = e.getRoot(),
      i = n.__rememberedObjects.indexOf(t.object);
    if (-1 !== i) {
      var o = n.__rememberedObjectIndecesToControllers[i];
      if (
        (void 0 === o && ((o = {}), (n.__rememberedObjectIndecesToControllers[i] = o)),
        (o[t.property] = t),
        n.load && n.load.remembered)
      ) {
        var r,
          s = n.load.remembered;
        if (s[e.preset]) r = s[e.preset];
        else {
          if (!s[re]) return;
          r = s[re];
        }
        if (r[i] && void 0 !== r[i][t.property]) {
          var a = r[i][t.property];
          (t.initialValue = a), t.setValue(a);
        }
      }
    }
  }
  function fe(e, t, n, i) {
    if (void 0 === t[n]) throw new Error('Object "' + t + '" has no property "' + n + '"');
    var o;
    if (i.color) o = new U(t, n);
    else if (i.gradient) o = new $(t, n, i.factoryArgs[0]);
    else {
      var r = [t, n].concat(i.factoryArgs);
      o = q.apply(e, r);
    }
    i.before instanceof v && (i.before = i.before.__li), he(e, o), A.addClass(o.domElement, "c");
    var s = document.createElement("span");
    A.addClass(s, "property-name"), (s.innerHTML = o.property);
    var a = document.createElement("div");
    a.appendChild(s), a.appendChild(o.domElement);
    var l = ue(e, a, i.before);
    return (
      A.addClass(l, ce.CLASS_CONTROLLER_ROW),
      o instanceof U ? A.addClass(l, "color") : A.addClass(l, typeof o.getValue()),
      (function(o, t, r) {
        if (
          ((r.__li = t),
          (r.__gui = o),
          _.extend(r, {
            options: function(e) {
              if (1 < arguments.length) {
                var t = r.__li.nextElementSibling;
                return r.remove(), fe(o, r.object, r.property, { before: t, factoryArgs: [_.toArray(arguments)] });
              }
              if (_.isArray(e) || _.isObject(e)) {
                var n = r.__li.nextElementSibling;
                return r.remove(), fe(o, r.object, r.property, { before: n, factoryArgs: [e] });
              }
            },
            name: function(e) {
              return (r.__li.firstElementChild.firstElementChild.innerHTML = e), r;
            },
            title: function(e) {
              return _.isString(e) ? r.__li.setAttribute("title", e) : r.__li.removeAttribute("title"), r;
            },
            listen: function() {
              return r.__gui.listen(r), r;
            },
            remove: function() {
              return r.__gui.remove(r), r;
            }
          }),
          r instanceof I)
        ) {
          var i = new V(r.object, r.property, { min: r.__min, max: r.__max, step: r.__step });
          _.each(["updateDisplay", "onChange", "onFinishChange", "step"], function(e) {
            var t = r[e],
              n = i[e];
            r[e] = i[e] = function() {
              var e = Array.prototype.slice.call(arguments);
              return n.apply(i, e), t.apply(r, e);
            };
          }),
            A.addClass(t, "has-slider"),
            r.domElement.insertBefore(i.domElement, r.domElement.firstElementChild);
        } else if (r instanceof V) {
          var e = function(e) {
            if (_.isNumber(r.__min) && _.isNumber(r.__max)) {
              var t = r.__li.firstElementChild.firstElementChild.innerHTML,
                n = -1 < r.__gui.__listening.indexOf(r);
              r.remove();
              var i = fe(o, r.object, r.property, {
                before: r.__li.nextElementSibling,
                factoryArgs: [r.__min, r.__max, r.__step]
              });
              return i.name(t), n && i.listen(), i;
            }
            return e;
          };
          (r.min = _.compose(
            e,
            r.min
          )),
            (r.max = _.compose(
              e,
              r.max
            ));
        } else
          r instanceof O
            ? (A.bind(t, "click", function() {
                A.fakeEvent(r.__checkbox, "click");
              }),
              A.bind(r.__checkbox, "click", function(e) {
                e.stopPropagation();
              }))
            : r instanceof z
            ? (A.bind(t, "click", function() {
                A.fakeEvent(r.__button, "click");
              }),
              A.bind(t, "mouseover", function() {
                A.addClass(r.__button, "hover");
              }),
              A.bind(t, "mouseout", function() {
                A.removeClass(r.__button, "hover");
              }))
            : r instanceof U
            ? (A.addClass(t, "color"),
              (r.updateDisplay = _.compose(
                function(e) {
                  return (t.style.borderLeftColor = r.__color.toString()), e;
                },
                r.updateDisplay
              )),
              r.updateDisplay())
            : r instanceof $ && (t.style.borderLeft = "3px solid #2FA1D6");
        r.setValue = _.compose(
          function(e) {
            return o.getRoot().__preset_select && r.isModified() && _e(o.getRoot(), !0), e;
          },
          r.setValue
        );
      })(e, l, o),
      e.__controllers.push(o),
      o
    );
  }
  function pe(e, t) {
    return "dat.gui." + (localStorage.getItem("dat.gui.namespace") || document.location.href) + "." + t;
  }
  function me(e, t, n) {
    var i = document.createElement("option");
    (i.innerHTML = t),
      (i.value = t),
      e.__preset_select.appendChild(i),
      n && (e.__preset_select.selectedIndex = e.__preset_select.length - 1);
  }
  function be(e, t) {
    t.style.display = e.useLocalStorage ? "block" : "none";
  }
  function ge(e, t) {
    (e.domElement.style.width = t + "px"),
      e.__save_row && e.autoPlace && (e.__save_row.style.width = t + "px"),
      e.__closeButton && (e.__closeButton.style.width = t + "px");
  }
  function ve(o, r) {
    var s = {};
    return (
      _.each(o.__rememberedObjects, function(e, t) {
        var n = {},
          i = o.__rememberedObjectIndecesToControllers[t];
        _.each(i, function(e, t) {
          n[t] = r ? e.initialValue : e.getValue();
        }),
          (s[t] = n);
      }),
      s
    );
  }
  (ce.toggleHide = function() {
    (le = !le),
      _.each(de, function(e) {
        e.domElement.style.display = le ? "none" : "";
      });
  }),
    (ce.CLASS_AUTO_PLACE = "a"),
    (ce.CLASS_AUTO_PLACE_CONTAINER = "ac"),
    (ce.CLASS_MAIN = "main"),
    (ce.CLASS_CONTROLLER_ROW = "cr"),
    (ce.CLASS_TOO_TALL = "taller-than-window"),
    (ce.CLASS_CLOSED = "closed"),
    (ce.CLASS_CLOSE_BUTTON = "close-button"),
    (ce.CLASS_CLOSE_TOP = "close-top"),
    (ce.CLASS_CLOSE_BOTTOM = "close-bottom"),
    (ce.CLASS_DRAG = "drag"),
    (ce.DEFAULT_WIDTH = 245),
    (ce.TEXT_CLOSED = "Close Controls"),
    (ce.TEXT_OPEN = "Open Controls"),
    (ce._keydownHandler = function(e) {
      !document.activeElement ||
        "text" === document.activeElement.type ||
        (72 !== e.which && 72 !== e.keyCode) ||
        ce.toggleHide();
    }),
    A.bind(window, "keydown", ce._keydownHandler, !1),
    _.extend(ce.prototype, {
      add: function(e, t) {
        return fe(this, e, t, { factoryArgs: Array.prototype.slice.call(arguments, 2) });
      },
      addColor: function(e, t) {
        return fe(this, e, t, { color: !0 });
      },
      addGradient: function(e, t) {
        return fe(this, e, t, { gradient: !0, factoryArgs: Array.prototype.slice.call(arguments, 2) });
      },
      remove: function(e) {
        var t = this.__listening.indexOf(e);
        -1 != t && this.__listening.splice(t, 1),
          this.__ul.removeChild(e.__li),
          this.__controllers.splice(this.__controllers.indexOf(e), 1);
        var n = this;
        _.defer(function() {
          n.onResize();
        });
      },
      destroy: function() {
        var t = this;
        _.each(this.__folders, function(e) {
          t.removeFolder(e);
        }),
          this.autoPlace && oe.removeChild(this.domElement),
          A.unbind(window, "keydown", ce._keydownHandler, !1),
          A.unbind(window, "resize", this.__resizeHandler),
          this.saveToLocalStorageIfPossible && A.unbind(window, "unload", this.saveToLocalStorageIfPossible);
        for (var e = this.__listening.length - 1; 0 <= e; e--) this.__listening.splice(e, 1);
      },
      addFolder: function(e, t) {
        if (void 0 !== this.__folders[e])
          throw new Error('You already have a folder in this GUI by the name "' + e + '"');
        var n = { name: e, parent: this, title: t };
        (n.autoPlace = this.autoPlace),
          this.load &&
            this.load.folders &&
            this.load.folders[e] &&
            ((n.closed = this.load.folders[e].closed), (n.load = this.load.folders[e]));
        var i = new ce(n);
        this.__folders[e] = i;
        var o = ue(this, i.domElement);
        return A.addClass(o, "folder"), i;
      },
      removeFolder: function(e) {
        var t = this.__folders[e];
        if (t) {
          t.close(),
            this.__ul.removeChild(t.domElement.parentElement),
            delete this.__folders[t.name],
            this.load && this.load.folders && this.load.folders[t.name] && delete this.load.folders[t.name];
          var n = this;
          _.defer(function() {
            n.onResize();
          });
        } else console.error('There is no folder in this GUI by the name "' + e + '"');
      },
      open: function() {
        this.closed = !1;
      },
      close: function() {
        this.closed = !0;
      },
      onResize: function() {
        var t = this.getRoot();
        if (t.scrollable) {
          var e = A.getOffset(t.__ul).top,
            n = 0;
          _.each(t.__ul.childNodes, function(e) {
            (t.autoPlace && e === t.__save_row) || (n += A.getHeight(e));
          }),
            window.innerHeight - e - 20 < n
              ? (A.addClass(t.domElement, ce.CLASS_TOO_TALL),
                (t.__ul.style.height = window.innerHeight - e - 20 + "px"))
              : (A.removeClass(t.domElement, ce.CLASS_TOO_TALL), (t.__ul.style.height = "auto"));
        }
        t.__resize_handle &&
          _.defer(function() {
            t.__resize_handle.style.height = t.__ul.offsetHeight + "px";
          }),
          t.__closeButton && (t.__closeButton.style.width = t.width + "px");
      },
      onResizeDebounced: _.debounce(function() {
        this.onResize();
      }, 50),
      remember: function() {
        if (
          (_.isUndefined(ie) &&
            ((ie = new te()).domElement.innerHTML =
              '<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),
          this.parent)
        )
          throw new Error("You can only call remember on a top level GUI.");
        var t = this;
        _.each(Array.prototype.slice.call(arguments), function(e) {
          0 === t.__rememberedObjects.length &&
            (function(n) {
              var e = (n.__save_row = document.createElement("li"));
              A.addClass(n.domElement, "has-save"),
                n.__ul.insertBefore(e, n.__ul.firstChild),
                A.addClass(e, "save-row");
              var t = document.createElement("span");
              (t.innerHTML = "&nbsp;"), A.addClass(t, "button gears");
              var i = document.createElement("span");
              (i.innerHTML = "Save"), A.addClass(i, "button"), A.addClass(i, "save");
              var o = document.createElement("span");
              (o.innerHTML = "New"), A.addClass(o, "button"), A.addClass(o, "save-as");
              var r = document.createElement("span");
              (r.innerHTML = "Revert"), A.addClass(r, "button"), A.addClass(r, "revert");
              var s = document.createElement("span");
              (s.innerHTML = "Delete"), A.addClass(s, "button"), A.addClass(s, "delete");
              var a = (n.__preset_select = document.createElement("select"));
              n.load && n.load.remembered
                ? _.each(n.load.remembered, function(e, t) {
                    me(n, t, t === n.preset);
                  })
                : me(n, re, !1);
              if (
                (A.bind(a, "change", function() {
                  for (var e = 0; e < n.__preset_select.length; e++)
                    n.__preset_select[e].innerHTML = n.__preset_select[e].value;
                  n.preset = this.value;
                }),
                e.appendChild(a),
                e.appendChild(t),
                e.appendChild(i),
                e.appendChild(o),
                e.appendChild(r),
                e.appendChild(s),
                se)
              ) {
                var l = document.getElementById("dg-local-explain"),
                  d = document.getElementById("dg-local-storage");
                (document.getElementById("dg-save-locally").style.display = "block"),
                  "true" === localStorage.getItem(pe(n, "isLocal")) && d.setAttribute("checked", "checked"),
                  be(n, l),
                  A.bind(d, "change", function() {
                    (n.useLocalStorage = !n.useLocalStorage), be(n, l);
                  });
              }
              var c = document.getElementById("dg-new-constructor");
              A.bind(c, "keydown", function(e) {
                !e.metaKey || (67 !== e.which && 67 !== e.keyCode) || ie.hide();
              }),
                A.bind(t, "click", function() {
                  (c.innerHTML = JSON.stringify(n.getSaveObject(), void 0, 2)), ie.show(), c.focus(), c.select();
                }),
                A.bind(i, "click", function() {
                  n.save();
                }),
                A.bind(o, "click", function() {
                  var e = prompt("Enter a new preset name.");
                  e && n.saveAs(e);
                }),
                A.bind(r, "click", function() {
                  n.revert();
                }),
                A.bind(s, "click", function() {
                  confirm("Are you sure you want to delete this preset?") && n.delete();
                });
            })(t),
            -1 === t.__rememberedObjects.indexOf(e) && t.__rememberedObjects.push(e);
        }),
          this.autoPlace && ge(this, this.width);
      },
      getRoot: function() {
        for (var e = this; e.parent; ) e = e.parent;
        return e;
      },
      getSaveObject: function() {
        var n = this.load;
        return (
          (n.closed = this.closed),
          0 < this.__rememberedObjects.length &&
            ((n.preset = this.preset), n.remembered || (n.remembered = {}), (n.remembered[this.preset] = ve(this))),
          (n.folders = {}),
          _.each(this.__folders, function(e, t) {
            n.folders[t] = e.getSaveObject();
          }),
          n
        );
      },
      save: function() {
        this.load.remembered || (this.load.remembered = {}),
          (this.load.remembered[this.preset] = ve(this)),
          _e(this, !1),
          this.saveToLocalStorageIfPossible();
      },
      saveAs: function(e) {
        this.load.remembered || ((this.load.remembered = {}), (this.load.remembered[re] = ve(this, !0))),
          (this.load.remembered[e] = ve(this)),
          (this.preset = e),
          me(this, e, !0),
          this.saveToLocalStorageIfPossible();
      },
      revert: function(t) {
        _.each(
          this.__controllers,
          function(e) {
            this.getRoot().load.remembered ? he(t || this.getRoot(), e) : e.setValue(e.initialValue),
              e.__onFinishChange && e.__onFinishChange.call(e, e.getValue());
          },
          this
        ),
          _.each(this.__folders, function(e) {
            e.revert(e);
          }),
          t || _e(this.getRoot(), !1);
      },
      delete: function() {
        this.preset !== re
          ? ((function(e, t) {
              e.__preset_select.removeChild(t), (e.__preset_select.selectedIndex = 0);
            })(this, this.__preset_select[this.__preset_select.selectedIndex]),
            delete this.load.remembered[this.preset],
            (this.preset = re),
            this.saveToLocalStorageIfPossible())
          : alert("Default preset can't be deleted.");
      },
      listen: function(e) {
        var t = 0 === this.__listening.length;
        this.__listening.push(e),
          t &&
            (function e(t) {
              0 !== t.length &&
                ee.call(window, function() {
                  e(t);
                });
              _.each(t, function(e) {
                e.updateDisplay();
              });
            })(this.__listening);
      },
      updateDisplay: function() {
        _.each(this.__controllers, function(e) {
          e.updateDisplay();
        }),
          _.each(this.__folders, function(e) {
            e.updateDisplay();
          });
      }
    });
  var ye = { Color: f, math: u, interpret: h },
    we = {
      Controller: v,
      BooleanController: O,
      OptionController: T,
      StringController: L,
      NumberController: H,
      NumberControllerBox: V,
      NumberControllerSlider: I,
      FunctionController: z,
      ColorController: U
    },
    Ee = { dom: A },
    Ce = { GUI: ce },
    xe = ce,
    Se = { color: ye, controllers: we, dom: Ee, gui: Ce, GUI: xe };
  (e.GUI = xe),
    (e.color = ye),
    (e.controllers = we),
    (e.default = Se),
    (e.dom = Ee),
    (e.gui = Ce),
    Object.defineProperty(e, "__esModule", { value: !0 });
});
